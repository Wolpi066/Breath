<section class="admin-page">
    <div class="admin-header">
        <h1>ADMIN DASHBOARD</h1>
        <div class="header-actions" style="display: flex; gap: 10px;">
            <button class="reset-db-btn" (click)="handleResetDB()"
                style="background: #dc2626; color: white; border: none; padding: 5px 10px; cursor: pointer; font-size: 10px;">
                ⚠️ RESETEAR DB
            </button>
            <button class="close-btn" (click)="close.emit()">✕</button>
        </div>
    </div>

    <div class="admin-wrapper">
        <div class="admin-tabs">
            <button class="tab-button" [class.active]="activeTab === 'productos'"
                (click)="setTab('productos')">PRODUCTOS</button>
            <button class="tab-button" [class.active]="activeTab === 'banners'" (click)="setTab('banners')">BANNERS
                HOME</button>
        </div>

        @if (activeTab === 'productos') {
        <div class="products-layout">
            <div class="form-section">
                @if (isEditing) {
                <h2 class="form-title">{{ editingProduct?.id ? 'EDITAR' : 'NUEVO' }}</h2>
                <form (ngSubmit)="handleSubmit($event)">

                    <div class="form-group"><label>NOMBRE</label><input type="text" [(ngModel)]="formData().name"
                            name="name" required></div>
                    <div class="form-group"><label>DESCRIPCIÓN</label><textarea [(ngModel)]="formData().description"
                            name="description" rows="3"></textarea></div>
                    <div class="form-group"><label>CATEGORÍA</label>
                        <select [(ngModel)]="formData().category" name="category" required>
                            @for (cat of categoriesOptions; track cat) { <option [value]="cat">{{ cat.toUpperCase() }}
                            </option> }
                        </select>
                    </div>

                    <div class="price-discount-row" style="display: flex; gap: 15px;">
                        <div class="form-group" style="flex: 1;"><label>PRECIO</label><input type="number"
                                [(ngModel)]="formData().price" name="price" min="0" required></div>
                        <div class="form-group" style="flex: 1;"><label>DESCUENTO (%)</label><input type="number"
                                [(ngModel)]="formData().discount" name="discount" min="0" max="100"></div>
                    </div>

                    <h3 class="size-header">TALLES Y STOCK</h3>
                    <div class="size-list">
                        @for (sizeEntry of formData().sizes ?? []; track $index) {
                        <div class="size-item">
                            <select [(ngModel)]="formData().sizes![$index].size" name="s{{$index}}" required>
                                @for (s of sizesOptions; track s) { <option [value]="s">{{ s }}</option> }
                            </select>
                            <input type="number" [(ngModel)]="formData().sizes![$index].stock" name="st{{$index}}"
                                placeholder="Stock">
                            <button type="button" class="remove-btn" (click)="handleRemoveSize($index)">X</button>
                        </div>
                        }
                        <button type="button" class="add-size-btn" (click)="handleAddSize()">+ TALLE</button>
                    </div>

                    <div class="form-group image-upload-wrapper">
                        <label>IMAGEN</label>
                        <input type="file" (change)="handleImageUpload($event, 'mainImage')">
                        @if(mainImagePreview()) { <img [src]="mainImagePreview()"
                            style="max-height:100px; margin-top:10px;"> }
                    </div>

                    <div class="form-actions" style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" style="background:black; color:white; padding:10px;">GUARDAR</button>
                        <button type="button" (click)="cancelEdit()"
                            style="border:1px solid #ccc; padding:10px;">CANCELAR</button>
                    </div>
                </form>
                } @else {
                <div style="text-align:center; padding-top:50px;">
                    <button (click)="newProduct()" class="upload-button" style="border:2px solid black;">+ NUEVO
                        PRODUCTO</button>
                </div>
                }
            </div>

            <div class="list-section">
                <h2>LISTA ({{ products.length }})</h2>
                <div class="product-list">
                    @for (product of filteredProducts; track product.id) {
                    <div class="product-card-admin">
                        <div class="product-details">
                            <h3>{{ product.name }}</h3>
                            <p>${{ product.price }} ({{ product.discount ?? 0 }}% OFF)</p>
                        </div>
                        <div class="admin-actions">
                            <button (click)="handleEdit(product)">EDITAR</button>
                            <button (click)="handleDelete(product.id)" style="color: red;">ELIMINAR</button>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
        }

        @if (activeTab === 'banners') {
        <div class="banner-section">
            <div class="banner-item">
                <label>BANNER 1</label>
                <input type="file" (change)="handleImageUpload($event, 'banner1')">
                @if(banner1Preview()) { <img [src]="banner1Preview()" style="max-width:100%; max-height:200px;"> }
            </div>
            <div class="banner-item">
                <label>BANNER 2</label>
                <input type="file" (change)="handleImageUpload($event, 'banner2')">
                @if(banner2Preview()) { <img [src]="banner2Preview()" style="max-width:100%; max-height:200px;"> }
            </div>
            <button class="save-banners-btn" (click)="handleSaveBanners()">GUARDAR BANNERS</button>
        </div>
        }
    </div>
</section>