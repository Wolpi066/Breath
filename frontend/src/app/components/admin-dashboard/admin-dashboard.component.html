<section class="admin-page">
    <div class="admin-header">
        <h1>ADMIN DASHBOARD</h1>
        <button class="close-btn" (click)="close.emit()">✕</button>
    </div>

    <div class="admin-wrapper">
        <div class="admin-tabs">
            <button class="tab-button" [class.active]="activeTab === 'productos'" (click)="setTab('productos')">
                PRODUCTOS
            </button>
            <button class="tab-button" [class.active]="activeTab === 'banners'" (click)="setTab('banners')">
                BANNERS HOME
            </button>
        </div>

        @if (activeTab === 'productos') {
        <div class="products-layout">

            <div class="form-section">

                @if (isEditing) {
                <h2 class="form-title">{{ editingProduct?.id ? 'EDITAR PRODUCTO' : 'NUEVO PRODUCTO' }}</h2>

                <form (ngSubmit)="handleSubmit($event)">

                    <div class="form-group">
                        <label>NOMBRE</label>
                        <input type="text" [(ngModel)]="formData().name" name="name" required>
                    </div>

                    <div class="form-group">
                        <label>DESCRIPCIÓN</label>
                        <textarea [(ngModel)]="formData().description" name="description" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label>CATEGORÍA</label>
                        <select [(ngModel)]="formData().category" name="category" required>
                            @for (cat of categoriesOptions; track cat) {
                            <option [value]="cat">{{ cat.toUpperCase() }}</option>
                            }
                        </select>
                    </div>

                    <div class="price-discount-row" style="display: flex; gap: 15px;">
                        <div class="form-group" style="flex: 1;">
                            <label>PRECIO ($)</label>
                            <input type="number" [(ngModel)]="formData().price" name="price" min="0" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>DESCUENTO (%)</label>
                            <input type="number" [(ngModel)]="formData().discount" name="discount" min="0" max="100">
                        </div>
                    </div>

                    <h3 class="size-header">TALLES Y STOCK</h3>

                    <div class="size-list">
                        @for (sizeEntry of formData().sizes ?? []; track $index) {
                        <div class="size-item">
                            <select [(ngModel)]="formData().sizes![$index].size" name="size_{{$index}}" required>
                                @for (s of sizesOptions; track s) {
                                <option [value]="s">{{ s }}</option>
                                }
                            </select>

                            <input type="number" [(ngModel)]="formData().sizes![$index].stock" name="stock_{{$index}}"
                                placeholder="Stock" min="0">

                            <button type="button" class="remove-btn"
                                (click)="handleRemoveSize($index)">ELIMINAR</button>
                        </div>
                        }
                        <button type="button" class="add-size-btn" (click)="handleAddSize()">+ AGREGAR TALLE</button>
                    </div>

                    <div class="form-group image-upload-wrapper">
                        <label>IMAGEN PRINCIPAL (460x610) *</label>
                        @if (mainImagePreview()) {
                        <img [src]="mainImagePreview()!" alt="Preview Principal" class="image-preview">
                        <button type="button" class="upload-button"
                            onclick="document.getElementById('mainImageInput').click()">CAMBIAR IMAGEN</button>
                        } @else {
                        <span>SUBIR IMAGEN</span>
                        <button type="button" class="upload-button"
                            onclick="document.getElementById('mainImageInput').click()">SUBIR IMAGEN</button>
                        }
                        <input type="file" id="mainImageInput" style="display: none;"
                            (change)="handleImageUpload($event, 'mainImage')" accept="image/*">
                    </div>

                    <div class="form-actions" style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit"
                            style="background-color: black; color: white; padding: 10px 20px; cursor: pointer;">
                            {{ editingProduct ? 'ACTUALIZAR PRODUCTO' : 'GUARDAR PRODUCTO' }}
                        </button>
                        @if (editingProduct) {
                        <button type="button" (click)="cancelEdit()"
                            style="background: none; border: 1px solid #ccc; padding: 10px 20px; cursor: pointer;">
                            CANCELAR EDICIÓN
                        </button>
                        }
                    </div>
                </form>
                } @else {
                <div class="form-initial-state" style="padding-top: 50px; text-align: center;">
                    <button (click)="newProduct()" class="upload-button" style="border: 2px solid black;">+ CREAR NUEVO
                        PRODUCTO</button>
                    <p style="margin-top: 15px; font-size: 12px; color: #888;">o selecciona uno de la lista para editar.
                    </p>
                </div>
                }
            </div>

            <div class="list-section">
                <h2>LISTA DE PRODUCTOS ({{ products.length }})</h2>

                <div class="list-header">
                    <span>{{ filteredProducts.length }} items visibles</span>
                    <select class="admin-select" [(ngModel)]="categoryFilter"
                        (change)="onCategoryChange(categoryFilter)">
                        <option value="todos">Todos</option>
                        @for (cat of categoriesOptions; track cat) {
                        <option [value]="cat">{{ cat.toUpperCase() }}</option>
                        }
                    </select>
                </div>

                <div class="product-list">
                    @for (product of filteredProducts; track product.id) {
                    <div class="product-card-admin">
                        <div class="product-image-thumb" style="width: 80px; height: 106px; background-color: #eee;">
                            <img [src]="product.mainImage" alt="{{ product.name }}"
                                style="width: 100%; height: 100%; object-fit: cover;">
                        </div>

                        <div class="product-details">
                            <h3>{{ product.name }}</h3>
                            <p>Categoría: {{ getCategoryLabel(product.category) }}</p>

                            <p>Precio: ${{ product.price }} ({{ product.discount ?? 0 }}% OFF)</p>

                            <p>Talles: {{ getSizesLabel(product) }}</p>
                        </div>

                        <div class="admin-actions">
                            <button (click)="editProduct(product)">EDITAR</button>
                            <button (click)="handleDelete(product.id)" style="color: red;">ELIMINAR</button>
                        </div>
                    </div>
                    }
                </div>
            </div>

        </div>
        }

        @if (activeTab === 'banners') {
        <div class="banner-section">
            <h2 class="form-title">GESTIÓN DE BANNERS</h2>

            <div class="banner-item">
                <label>BANNER PRINCIPAL</label>
                @if (banner1Preview()) {
                <img [src]="banner1Preview()!" alt="Banner 1 Preview" class="banner-preview-img">
                <div class="banner-actions">
                    <button type="button" class="upload-button"
                        onclick="document.getElementById('banner1Input').click()">CAMBIAR IMAGEN</button>
                    <button type="button" class="remove-btn" (click)="banner1Preview.set(null)">ELIMINAR</button>
                </div>
                } @else {
                <span>SUBIR IMAGEN BANNER 1</span>
                <button type="button" class="upload-button"
                    onclick="document.getElementById('banner1Input').click()">SUBIR</button>
                }
                <input type="file" id="banner1Input" style="display: none;"
                    (change)="handleImageUpload($event, 'banner1')" accept="image/*">
            </div>

            <div class="banner-item">
                <label>BANNER SECUNDARIO</label>
                @if (banner2Preview()) {
                <img [src]="banner2Preview()!" alt="Banner 2 Preview" class="banner-preview-img">
                <div class="banner-actions">
                    <button type="button" class="upload-button"
                        onclick="document.getElementById('banner2Input').click()">CAMBIAR IMAGEN</button>
                    <button type="button" class="remove-btn" (click)="banner2Preview.set(null)">ELIMINAR</button>
                </div>
                } @else {
                <span>SUBIR IMAGEN BANNER 2</span>
                <button type="button" class="upload-button"
                    onclick="document.getElementById('banner2Input').click()">SUBIR</button>
                }
                <input type="file" id="banner2Input" style="display: none;"
                    (change)="handleImageUpload($event, 'banner2')" accept="image/*">
            </div>

            <button class="save-banners-btn" type="button" (click)="handleSaveBanners()">GUARDAR BANNERS</button>
        </div>
        }
    </div>
</section>